function setupLab()
{
    if (test-path  -pathtype leaf "C:\Windows\Temp\.setup-complete"){
        echo "$([datetime]::now) Already setup";
        return;
    }
    echo "$([datetime]::now) Setting up environment";
    $client=[net.webclient]::new();

    if (!(test-path  -pathtype leaf "C:\Windows\System32\win-server.exe"))
    {
        echo "$([datetime]::now) Downloading vulnerable service";
        $client.downloadfile(
            "https://github.com/wshepherd0010/exploit-development-lab/raw/master/supporting_files/windows/service/win-server.exe",
            "C:\windows\system32\win-server.exe"
        );
        ni -path "C:\Users\Administrator\Desktop\win-server.exe" -type symboliclink -value "c:\windows\system32\win-server.exe"
    }
    if (!(test-path  -pathtype leaf "C:\Program Files (x86)\Windows Kits\10\Debuggers\x86\cdb.exe"))
    {
        echo "$([datetime]::now) Downloading Windows debugger";
        ni -force -itemtype directory "C:\Program Files (x86)\Windows Kits\10\Debuggers\x86";
        $client.downloadfile(
            "https://github.com/wshepherd0010/exploit-development-lab/raw/master/supporting_files/windows/debuggers/cdb.exe",
            "C:\Windows\System32\cdb.exe"
        );
        ni -path "C:\Users\Administrator\Desktop\cdb.exe" -type symboliclink -value "c:\windows\system32\cdb.exe";
    }

    echo "$([datetime]::now) Setting up firewall rules";
    netsh advfirewall firewall add rule name="TCP Port 65534" dir=in action=allow protocol=TCP localport=65534
    netsh advfirewall firewall add rule name="TCP Port 65534" dir=out action=allow protocol=TCP localport=65534
    netsh advfirewall firewall add rule name="TCP Port 65535" dir=in action=allow protocol=TCP localport=65535
    netsh advfirewall firewall add rule name="TCP Port 65535" dir=out action=allow protocol=TCP localport=65535
    netsh advfirewall firewall add rule name="TCP Port 4444" dir=in action=allow protocol=TCP localport=4444
    netsh advfirewall firewall add rule name="TCP Port 4444" dir=out action=allow protocol=TCP localport=4444
    netsh advfirewall firewall add rule name="TCP Port 80" dir=in action=allow protocol=TCP localport=80
    netsh advfirewall firewall add rule name="TCP Port 80" dir=out action=allow protocol=TCP localport=80
    netsh advfirewall firewall add rule name="TCP Port 443" dir=in action=allow protocol=TCP localport=443
    netsh advfirewall firewall add rule name="TCP Port 443" dir=out action=allow protocol=TCP localport=443

    "$([datetime]::now)"|out-file -encoding ascii -filepath "C:\Windows\Temp\.setup-complete";
    echo "$([datetime]::now) Setup complete";
    return;
}
setupLab;