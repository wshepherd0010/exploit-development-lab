function setupFiles()
{
    echo "$([datetime]::now) setting up environment";
    $sysdir="C:\Windows\System32";
    $tmpdir="C:\Windows\Temp";
    if (test-path  -pathtype leaf "$($tmpDir)\.setup-complete"){
        echo "$([datetime]::now) already setup";
        return;
    }
    if (!(test-path  -pathtype leaf "$($sysDir)\cdb.exe")){
        echo "$([datetime]::now) setting up debugger cdb.exe";
        copy "$($tmpDir)\cdb.exe" "$($sysDir)\cdb.exe";
    }
    if (!(test-path  -pathtype leaf "$($sysDir)\win-server.exe"))
    {
        echo "$([datetime]::now) setting up vuln service";
        copy "$($tmpDir)\win-server.exe" "$($sysDir)\win-server.exe";
        echo "$([datetime]::now) setting up firewall rules";
        netsh advfirewall firewall add rule name="TCP Port 65534" dir=in action=allow protocol=TCP localport=65534
        netsh advfirewall firewall add rule name="TCP Port 65534" dir=out action=allow protocol=TCP localport=65534
        netsh advfirewall firewall add rule name="TCP Port 65535" dir=in action=allow protocol=TCP localport=65535
        netsh advfirewall firewall add rule name="TCP Port 65535" dir=out action=allow protocol=TCP localport=65535
        netsh advfirewall firewall add rule name="TCP Port 4444" dir=in action=allow protocol=TCP localport=4444
        netsh advfirewall firewall add rule name="TCP Port 4444" dir=out action=allow protocol=TCP localport=4444
        netsh advfirewall firewall add rule name="TCP Port 80" dir=in action=allow protocol=TCP localport=80
        netsh advfirewall firewall add rule name="TCP Port 80" dir=out action=allow protocol=TCP localport=80
        netsh advfirewall firewall add rule name="TCP Port 443" dir=in action=allow protocol=TCP localport=443
        netsh advfirewall firewall add rule name="TCP Port 443" dir=out action=allow protocol=TCP localport=443
    }
    "$([datetime]::now)"|out-file -encoding ascii -filepath "$($tmpDir)\.setup-complete";
    echo "$([datetime]::now) setup complete";
    return;
}

if (!(test-path -pathtype leaf "$($tmpDir)\.setup-complete")){ setupFiles };
while ($true){ cmd /c C:\Windows\System32\win-server.exe };